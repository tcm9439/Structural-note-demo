import{d as D,c as J,i as C,q as s,s as y,t as E,x as i,y as r,J as e,K as H,v as f,L as K,r as h,M as u,N as U,O as X,P as $,Q as Z,z as k,R as P,S,T as v,U as b,o as j,V,W as R,e as ee,X as te,Y as B,l as q,Z as W}from"./entry.fb632390.js";import{_ as A}from"./_plugin-vue_export-helper.c27b6911.js";import{e as I}from"./exception.03807a46.js";import{_ as oe}from"./note.vue.dde26e69.js";import"./NoteExportHandler.3336c0aa.js";import"./Icon.bbccf725.js";const ne={class:"mt-choice-image-box"},ae={class:"mt-choice-label"},le=D({__name:"image-choice",props:{id:{},label:{},chosen:{type:Boolean},image_path:{}},emits:["select"],setup(N,{emit:o}){const c=N,t=J(()=>{let a="mt-choice-container";return c.chosen&&(a+=" mt-chosen"),a}),d=o;function n(){d("select",c.id)}return(a,w)=>{const p=C("Image");return s(),y("div",{onClick:n,class:K(e(t))},[E("div",ne,[i(p,{width:"200px",height:"100px",src:c.image_path},{error:r(()=>[i(e(H.Icon),{type:"ios-image-outline",size:"24",color:"#ccc"})]),_:1},8,["src"])]),E("div",ae,f(c.label),1)],2)}}});const ce=A(le,[["__scopeId","data-v-8ab1d27f"]]),se={class:"mt-template-label"},_e={class:"mt-template-list-container"},ie=D({__name:"note-template",emits:["select"],setup(N,{emit:o}){const c=Z,t=h("blank"),d=o;function n(a){t.value=a,d("select",a)}return(a,w)=>{const p=ce;return s(),y(U,null,[E("div",se,f(e(u)("structural.template.select_template")),1),E("div",_e,[(s(!0),y(U,null,X(e(c),l=>(s(),$(p,{id:l.id,label:l.label.toDisplayText(),chosen:e(t)==l.id,image_path:l.image_path,onSelect:n},null,8,["id","label","chosen","image_path"]))),256))])],64)}}});const re=A(ie,[["__scopeId","data-v-aa54383a"]]),ue={class:"mt-init-note-modal"},de={key:0},pe=E("span",{style:{color:"red"}},"*",-1),me={key:1},fe={key:0},ge={key:1},ve=D({__name:"init-note",setup(N){const o=h(!1);async function c(){o.value=!0;try{await S.openNote()}catch(l){I(l,"error.general.open_note")}o.value=!1}const t=h(!1),d=h("blank"),n=h(u("structural.file.untitled"));function a(l){t.value=l}function w(l){d.value=l}function p(){try{v.logger.debug(`Creating note: ${n.value??"default title"}`),S.createNote(n.value,d.value)}catch(l){I(l,"error.general.create_note")}}return(l,m)=>{const O=C("Input"),T=re,x=C("Button"),L=C("Space"),M=C("Modal");return s(),$(M,{styles:{top:"40px"},"model-value":!0,closable:!1,"mask-closable":!1,width:"85"},{footer:r(()=>[e(t)?(s(),y("div",fe,[i(x,{onClick:m[2]||(m[2]=_=>a(!1))},{default:r(()=>[k(f(e(u)("common.cancel")),1)]),_:1}),i(x,{onClick:p,type:"primary"},{default:r(()=>[k(f(e(u)("common.create")),1)]),_:1})])):(s(),y("div",ge,[i(x,{onClick:p},{default:r(()=>[k(f(e(u)("common.cancel")),1)]),_:1})]))]),default:r(()=>[E("div",ue,[e(t)?(s(),y("div",de,[k(f(e(u)("structural.file.filename")),1),pe,i(O,{modelValue:e(n),"onUpdate:modelValue":m[0]||(m[0]=_=>P(n)?n.value=_:null)},null,8,["modelValue"]),i(T,{onSelect:w})])):(s(),y("div",me,[i(L,{direction:"vertical",style:{width:"100%"}},{default:r(()=>[i(x,{long:"",type:"primary",onClick:m[1]||(m[1]=_=>a(!0))},{default:r(()=>[k(f(e(u)("structural.file.create_note")),1)]),_:1}),i(x,{long:"",type:"primary",onClick:c,loading:e(o)},{default:r(()=>[k(f(e(u)("structural.file.open_existing_note")),1)]),_:1},8,["loading"])]),_:1})]))])]),_:1})}}}),he=D({__name:"close-note",props:{enabled:{type:Boolean},close_success_callback:{type:Function},close_cancel_callback:{type:Function}},emits:["update:enabled"],setup(N,{emit:o}){const c=N,t=o,d=u("common.save_confirm_window.title",null,{target:u("structural.file.note")});async function n(){v.logger.debug("Saving note before closing window..."),await S.saveNote(),c.close_success_callback(),t("update:enabled",!1)}function a(){v.logger.debug("Cancel closing window."),c.close_cancel_callback(),t("update:enabled",!1)}function w(){v.logger.debug("Close without saving."),c.close_success_callback(),t("update:enabled",!1)}return(p,l)=>{const m=C("Button"),O=C("Modal");return s(),$(O,{styles:{top:"40px"},"model-value":!0,closable:!1,"mask-closable":!1,title:e(d)},{footer:r(()=>[i(m,{onClick:a},{default:r(()=>[k(f(e(u)("common.cancel")),1)]),_:1}),i(m,{onClick:n,type:"primary"},{default:r(()=>[k(f(e(u)("common.save_confirm_window.save")),1)]),_:1}),i(m,{onClick:w,type:"error"},{default:r(()=>[k(f(e(u)("common.save_confirm_window.do_not_save")),1)]),_:1})]),default:r(()=>[E("div",null,f(e(u)("common.save_confirm_window.content")),1)]),_:1},8,["title"])}}}),ye={key:2},we={key:0,class:"mt-open-note-spin-container"},be=D({__name:"index",async setup(N){let o,c;const{$emitter:t,$viewState:d}=q(),n=h(null),a=h(!1),w=h(!0),p=h(!0),l=h(!1),m=h(()=>{}),O=h(()=>{});function T(){v.logger.debug("Note open / change event."),n.value=d.editing_note,a.value=n.value!=null}function x(_,g){v.logger.debug("Window close request event."),l.value=!0,m.value=_??(()=>{}),O.value=g??(()=>{})}t.on(b.NOTE_OPENED,T),t.on(b.NOTE_CLOSED,T),t.on(b.WINDOW_CLOSED_REQUEST,x),j(async()=>{try{d.editing_note!=null?(n.value=d.editing_note,a.value=!0):(a.value=await S.openInitNoteForThisWindow(),v.logger.debug(`Has open note: ${a.value}`))}catch(_){v.logger.error(`Error when init page: ${_}`),a.value=!1,p.value=!1,I(_,"error.general.open_note"),t.once(b.ERROR_MODAL_CLOSED,()=>{p.value=!0})}w.value=!1});const L=([o,c]=V(async()=>R.onFileDropEvent(async _=>{v.logger.debug(`Got event in window ${_.windowLabel}, payload: ${_.payload}`);try{if(_.payload.type!="drop")return;let g=S.getPathFromSelectedFiles(_.payload.paths);v.logger.debug(`Selected open path: ${g}`),await S.openNote(null,g)}catch(g){p.value=!1,I(g,"error.general.open_note"),t.once(b.ERROR_MODAL_CLOSED,()=>{p.value=!0})}})),o=await o,c(),o),M=([o,c]=V(async()=>R.onCloseRequested(async _=>{v.logger.info("Close window request."),_.preventDefault();let g=async()=>{await v.logger.close(),R.close()};n.value!=null?await S.closeNote(g):g()})),o=await o,c(),o);return ee(()=>{t.off(b.NOTE_OPENED,T),t.off(b.NOTE_CLOSED,T),t.off(b.WINDOW_CLOSED_REQUEST,x),L(),M(),te("remove_opened_file",{windowId:d.window_id})}),(_,g)=>{const F=C("Spin"),z=ve,Q=he,Y=oe;return s(),y("div",null,[i(F,{size:"large",fix:"",show:e(w),class:"mt-loading-init-page-spin"},null,8,["show"]),!e(w)&&e(p)&&!e(a)?(s(),$(z,{key:0})):B("",!0),e(l)?(s(),$(Q,{key:1,enabled:e(l),"onUpdate:enabled":g[0]||(g[0]=G=>P(l)?l.value=G:null),close_success_callback:e(m),close_cancel_callback:e(O)},null,8,["enabled","close_success_callback","close_cancel_callback"])):B("",!0),e(a)?(s(),y("div",ye,[e(n)==null?(s(),y("div",we,[i(F,{fix:""},{default:r(()=>[i(e(H.Icon),{type:"ios-loading",size:"18"}),E("div",null,f(e(u)("common.loading")),1)]),_:1})])):(s(),$(Y,{key:1,note:e(n)},null,8,["note"]))])):B("",!0)])}}});const ke=A(be,[["__scopeId","data-v-31fc1721"]]),Oe=D({__name:"index",setup(N){const{$viewState:o,$emitter:c}=q();return o.last_page=W.HOME,c.emit(b.LAYOUT_UPDATE,W.HOME),(t,d)=>{const n=ke;return s(),$(n)}}});export{Oe as default};
